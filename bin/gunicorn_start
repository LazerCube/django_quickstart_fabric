#!/bin/bash

description "Gunicorn daemon for Django project"

start on (local-filesystems and net-device-up IFACE=enp0s3)
stop on runlevel [!12345]

BASH_PROFILE=/home/ubuntu/.bash_profile
DJANGO_DIR=/home/ubuntu/myproject/myproject
WSGI_MODULE=myproject.wsgi
USER=ubuntu
GROUP=ubuntu
ADDRESS=localhost:9000
NUM_WORKERS=3
LOG_FILE=/home/ubuntu/myproject/logs/gunicorn.log
LOG_LEVEL=debug

# If the process quits unexpectedly trigger a respawn
respawn

cd $DJANGO_DIR
source $BASH_PROFILE
workon myproject
exec gunicorn $WSGI_MODULE \
  --user=$USER \
  --group=$GROUP \
  --bind=$ADDRESS \
  --workers=$NUM_WORKERS \
  --log-file=$LOG_FILE \
  --log-level=$LOG_LEVEL
